{% extends 'dashboard/base.html' %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total Devices</h3>
        <div class="number">{{ total_devices }}</div>
    </div>
    <div class="stat-card">
        <h3>Online Devices</h3>
        <div class="number">{{ online_devices }}</div>
    </div>
    <div class="stat-card">
        <h3>Locked Devices</h3>
        <div class="number">{{ locked_devices }}</div>
    </div>
    <div class="stat-card">
        <h3>Open Incidents</h3>
        <div class="number">{{ open_incidents }}</div>
    </div>
</div>

<div class="content-card">
    <h2>Recent Events</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Event Type</th>
                <th>Device</th>
                <th>Severity</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody>
            {% for event in recent_events %}
            <tr>
                <td>{{ event.timestamp|date:"Y-m-d H:i:s" }}</td>
                <td>{{ event.get_event_type_display }}</td>
                <td>{{ event.device.name|default:"System" }}</td>
                <td>
                    <span class="badge {{ event.severity }}">{{ event.get_severity_display }}</span>
                </td>
                <td>{{ event.message|truncatechars:60 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No recent events</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="content-card">
    <h2>API Documentation</h2>
    <p>The Agent Screen Lock system provides RESTful APIs for device management, monitoring, and administration.</p>

    <h3>Authentication</h3>
    <p><strong>POST /api/auth/login/</strong> - Login with username/password to get JWT token</p>
    <p><strong>POST /api/auth/refresh/</strong> - Refresh JWT token</p>
    <p><strong>POST /api/auth/logout/</strong> - Logout and invalidate session</p>

    <h3>Device Management</h3>
    <p><strong>GET /api/devices/</strong> - List all devices with filtering</p>
    <p><strong>POST /api/devices/</strong> - Register new device</p>
    <p><strong>POST /api/devices/{device_id}/heartbeat/</strong> - Send device heartbeat</p>
    <p><strong>POST /api/devices/{device_id}/action/</strong> - Send action to device (lock/unlock/screenshot)</p>

    <h3>Policy Management</h3>
    <p><strong>GET /api/policies/</strong> - List all policies</p>
    <p><strong>POST /api/policies/</strong> - Create new policy</p>
    <p><strong>GET /api/policies/device/{device_id}/</strong> - Get effective policy for device</p>

    <h3>Events & Monitoring</h3>
    <p><strong>GET /api/events/</strong> - List events with filtering</p>
    <p><strong>GET /api/events/incidents/</strong> - List security incidents</p>
    <p><strong>GET /api/events/stats/</strong> - Get event statistics</p>

    <h3>Forensics</h3>
    <p><strong>GET /api/forensics/screenshots/</strong> - List screenshots</p>
    <p><strong>GET /api/forensics/audit-logs/</strong> - List audit logs</p>
    <p><strong>GET /api/forensics/evidence/</strong> - List forensic evidence</p>
</div>
{% endblock %}